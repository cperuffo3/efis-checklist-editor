# Prettier Workflows

## Contents

- Format-Then-Lint Workflow
- Fixing Formatting Errors
- Formatting Specific Files
- Working With shadcn/ui Components
- CI Validation
- Editor Integration

## Format-Then-Lint Workflow

The standard workflow before committing:

```bash
# 1. Format all files
pnpm run format

# 2. Lint (catches non-formatting issues + verifies formatting)
pnpm run lint

# 3. If lint fails, fix and repeat step 2
```

Copy this checklist and track progress:

- [ ] Step 1: Run `pnpm run format`
- [ ] Step 2: Run `pnpm run lint`
- [ ] Step 3: If lint fails with non-formatting errors, fix the code
- [ ] Step 4: Repeat steps 1-2 until clean
- [ ] Step 5: Commit

### Why Format Before Lint

`eslint-plugin-prettier` runs Prettier as an ESLint rule. If you only run `pnpm run lint`, ESLint reports formatting issues as errors but `--fix` may not catch everything Prettier would. Running `pnpm run format` first ensures a clean pass.

## Fixing Formatting Errors

When ESLint reports Prettier errors:

```
error  Replace `'@/components/ui/button'` with `"@/components/ui/button"`  prettier/prettier
error  Insert `,`                                                           prettier/prettier
error  Delete `··`                                                          prettier/prettier
```

**Fix:** Run `pnpm run format` — it resolves all `prettier/prettier` errors in one pass.

```bash
# Fix all formatting at once
pnpm run format

# Or fix a single file
npx prettier --write src/components/editor/toolbar.tsx
```

### WARNING: Manual Formatting Fixes

**The Problem:**

Manually fixing each `prettier/prettier` error one by one in the editor.

**Why This Breaks:** Wasted time. Prettier is deterministic — running the formatter once fixes everything. Never manually fix formatting errors.

**The Fix:**

```bash
# GOOD — one command fixes all formatting
pnpm run format
```

## Formatting Specific Files

```bash
# Single file
npx prettier --write src/stores/checklist-store.ts

# Glob pattern
npx prettier --write "src/components/editor/**/*.tsx"

# Check without writing (see what would change)
npx prettier --check "src/components/editor/**/*.tsx"
```

## Working With shadcn/ui Components

After adding a new shadcn component:

```bash
# 1. Add component
npx shadcn@latest add switch

# 2. Format the newly added file (shadcn output may use single quotes)
pnpm run format

# 3. Verify
pnpm run lint
```

See the **shadcn-ui** skill for component patterns.

## CI Validation

For CI pipelines, use `--check` mode which exits non-zero if files aren't formatted:

```bash
# CI step — fails if any file needs formatting
npx prettier --check .
```

This is faster than `pnpm run lint` for checking formatting alone.

## Iterate-Until-Pass Pattern

When making changes that touch many files:

1. Make code changes
2. Run `pnpm run format`
3. Run `pnpm run lint`
4. If lint fails with non-formatting errors, fix the code issues
5. Repeat from step 2 until `pnpm run lint` passes cleanly
6. Only then commit

## Editor Integration

The `.prettierrc` at project root is auto-detected by VS Code (with the Prettier extension) and other editors. No additional editor config needed.

### WARNING: Editor-Level Prettier Config

**The Problem:**

Using global Prettier settings in your editor that differ from `.prettierrc` (e.g., single quotes in your global config).

**Why This Breaks:** Your editor formats with different rules than the project. When CI runs `prettier --check`, it fails. Other contributors see unnecessary diffs.

**The Fix:** Ensure your editor uses workspace config (the default behavior for the Prettier VS Code extension). Never override with user-level settings for this project.

## Files That MUST Be Ignored

The `.prettierignore` excludes:

```gitignore
/dist
/coverage
/.vite
/src/routeTree.gen.ts
pnpm-lock.yaml
package-lock.json
yarn.lock
```

`/src/routeTree.gen.ts` is auto-generated by TanStack Router. See the **tanstack-router** skill. Formatting it causes unnecessary diffs and potential conflicts on regeneration.

### Adding New Ignore Patterns

If you add generated files or vendor code, add them to `.prettierignore`. The ESLint config in `eslint.config.mjs` imports `.prettierignore` via `includeIgnoreFile()`, so both tools share the same ignore list.
